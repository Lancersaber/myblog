---
title: 大型网站系统架构的演进
time: 2019-11-14
categories: unknow
tags: unknow
---

# 大型网站系统架构的演进
---
为了更好的说明网站从小到大的演进过程，我们下面举个交易网站的例子。
作为一个交易网站，需要具备的最基本的三个功能有三部分：
* 用户
	+ 用户注册
	+ 用户管理
	+ 信息维护
* 商品
	+ 商品展示
	+ 商品管理
* 交易
	+ 创建交易
	+ 交易管理

基于Java技术的网站大概是这样的
![web架构.PNG](https://i.loli.net/2019/11/14/D71oEpYGk5z2uCa.png)

这里需要注意两个地方
* 各个功能模块之间是通过JVM内部的方法来进行交互的
* 应用和数据库之间是通过JDBC进行访问的

## 单机负载告警，数据库与应用分离
当网站的访问量不断增大时，服务器的负载持续升高，必须采取一些方法来应对。首先我们可以做的是把数据库与应用从一台机器分别分到两台机器，那么我们的网站架构会变成这样
![web.PNG](https://i.loli.net/2019/11/14/OirqLbdHMukm9pz.png)
我们只是在在应用的配置中把数据库的地址从本机改到了另外一台机器上而已。

## 应用服务器负载告警，如何让应用服务器走向集群
应用服务器压力变大时，根据对应用的监测结果，可以有针对性地进行优化。
首先来看一下这个变化
![web2.PNG](https://i.loli.net/2019/11/14/Nt2MzC1jA8dar3h.png)
应用服务器从一台变为两台。这两个服务器之间没有直接的交互，都是依赖数据库对外提供服务。但这样有两个问题需要解决：
1. 最终用户对两个应用服务器的选择问题
2. Session的问题

### 引入负载均衡设备
采用了负载均衡设备后，系统的结构看起来如下：
![web3.PNG](https://i.loli.net/2019/11/14/6rhQBkCKTW4e72s.png)

## 数据库压力变大，读写分离吧

### 采用数据库作为读库
随着业务的发展，数据量和访问量都在增长，对于大型网站来说，有不少业务是读多写少的，这个状况也会直接反应到数据库上。对于这种情况，我们可以考虑使用读写分离的方式。
![web4.PNG](https://i.loli.net/2019/11/14/LAhKITyUusSHGFX.png)

这个结构的变化会带来两个问题
* 数据复制问题
* 应用对于数据源的选择问题

### 加速数据读取的利器--缓存
在大型网站中，有许多地方都会用到缓存机制
1、 数据缓存
大型系统中的数据缓存主要用于分担数据库的读的压力。缓存系统一般是用来保存和查询键值对(Key-Value)对的。一般我们在缓存中放的是“热”数据而不是全部数据。

2、页面缓存

### 弥补关系型数据库的不足，引入分布式存储系统

### 读写分离后，数据库又遇到瓶颈

#### 专库专用，数据垂直拆分

#### 垂直拆分后的单机遇到瓶颈，数据水平拆分


## 数据库问题解决后，应用面对的新挑战

### 拆分应用

