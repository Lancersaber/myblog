---
title: 数据库的垂直拆分和水平拆分
time: 2019-11-12
categories: database
tags: database
---

# 数据库的垂直拆分和水平拆分
---
当我们使用读写分离、缓存后，数据库的压力还是很大的时候，这就需要使用到数据库拆分了。
数据库拆分简单来说，就是指通过某种特定的条件，按照某个维度，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面以达到分散单库（主机）负载的效果。 

切分模式： 垂直（纵向）拆分、水平拆分。

## 垂直拆分
 一个数据库由很多表的构成，每个表对应着不同的业务，垂直切分是指按照业务将表进行分类，分布到不同的数据库上面，这样也就将数据或者说压力分担到不同的库上面，如下图：
![11111.PNG](https://i.loli.net/2019/11/12/1Iwcd5eFkqrzCbS.png)
 优点：
1. 拆分后业务清晰，拆分规则明确。
2. 系统之间整合或扩展容易。
3. 数据维护简单。

缺点：
1. 单机的ACID保证被打破了。数据到了多机后，原来在单机通过事务来进行的处理逻辑会受很大的影响。我们面临的选择是，要么放弃原来的单机事务，修改事务，要么引入分布式事务
2. 一些join操作会变得比较困难，因为数据可能已经在两个数据库中了，所以不能很方便地利用数据自身的join了。需要应用或者其他方式来解决，
3. 靠外键去进行约束的场景会受到影响

## 水平拆分
 垂直拆分后遇到单机瓶颈，可以使用水平拆分。相对于垂直拆分的区别是：垂直拆分是把不同的表拆到不同的数据库中，而水平拆分是把同一个表拆到不同的数据库中。

 相对于垂直拆分，水平拆分不是将表的数据做分类，而是按照某个字段的某种规则来分散到多个库之中，每个表中包含一部分数据。简单来说，我们可以将数据的水平切分理解为是按照数据行的切分，就是将表中 的某些行切分到一个数据库，而另外的某些行又切分到其他的数据库中，主要有分表，分库两种模式，如图：
![20160910084749776.png](https://i.loli.net/2019/11/12/ZpXLBiVybFOswJ7.png)
![20160910084811416.png](https://i.loli.net/2019/11/12/u4a8O7RCLz1UJKI.png)

优点：
1. 不存在单库大数据，高并发的性能瓶颈。
2. 对应用透明，应用端改造较少。     
3. 按照合理拆分规则拆分，join操作基本避免跨库。
4. 提高了系统的稳定性跟负载能力。

缺点：
1. 拆分规则难以抽象。
2. 分片事务一致性难以解决。
3. 数据多次扩展难度跟维护量极大。
4. 跨库join性能较差。